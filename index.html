<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>~SADRAZAM SECURITY OS~</title>
    <style>
        :root {
            --bg: #030303;
            --card: #0a0a0a;
            --accent: #00ffcc;
            --text: #e0e0e0;
            --border: #1a1a1a;
            --red: #ff3e3e;
            --orange: #ff9f43;
            --glow: 0 0 15px rgba(0, 255, 204, 0.3);
        }

        body { font-family: 'Consolas', 'Courier New', monospace; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .header { text-align: center; padding: 30px; border-bottom: 1px solid var(--accent); margin-bottom: 40px; }
        .logo { font-size: 1.8rem; color: var(--accent); font-weight: bold; letter-spacing: 6px; text-shadow: var(--glow); }
        
        .container { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr; gap: 25px; }
        .tool-card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 8px; position: relative; }
        .tool-card::before { content: ""; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--accent); }

        h2 { font-size: 0.9rem; color: var(--accent); text-transform: uppercase; margin-bottom: 20px; letter-spacing: 2px; display: flex; align-items: center; }
        h2::after { content: ""; flex: 1; height: 1px; background: var(--border); margin-left: 15px; }

        .btn { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 12px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; text-transform: uppercase; font-size: 0.75rem; outline: none; }
        .btn:hover { background: var(--accent); color: #000; box-shadow: var(--glow); }
        .btn-secondary { border-color: var(--orange); color: var(--orange); }

        .mail-address { background: #000; padding: 12px; border: 1px dashed var(--accent); color: var(--accent); font-weight: bold; text-align: center; margin-bottom: 15px; word-break: break-all; min-height: 20px; }
        .inbox { min-height: 200px; max-height: 350px; border: 1px solid var(--border); background: #000; padding: 10px; overflow-y: auto; font-size: 0.8rem; }
        .mail-item { padding: 12px; border-bottom: 1px solid #1a1a1a; cursor: pointer; background: #050505; margin-bottom: 5px; transition: 0.2s; }
        .mail-item:hover { border-color: var(--accent); background: #0a0a0a; }
        .mail-subject { color: var(--accent); font-weight: bold; display: block; margin-bottom: 3px; }
        .mail-meta { font-size: 0.7rem; color: #666; }

        .loading-spinner { color: var(--orange); text-align: center; padding: 20px; font-style: italic; }
        
        @media (min-width: 768px) { .container { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">~ SADRAZAM SECURITY OS ~</div>
    <div style="font-size: 0.6rem; color: #444; margin-top: 10px;">LATEST API DOCS V3.1 ENTEGRATED - 2026</div>
</div>

<div class="container">
    <div class="tool-card">
        <h2>Dinamik Mail.tm (Official API)</h2>
        <div id="mailAddr" class="mail-address">INITIALIZING MODULE...</div>
        <div style="display: flex; gap: 5px; margin-bottom: 15px;">
            <button class="btn" onclick="copyMail()">KOPYALA</button>
            <button class="btn" onclick="generateNewMail()">YENİ ADRES ÜRET</button>
        </div>
        <div class="inbox" id="mailInbox">
            <div class="loading-spinner">Inbox listener standby...</div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="refreshInbox()">GELEN KUTUSUNU SORGULA</button>
    </div>

    <div class="tool-card">
        <h2>Sistem Analizi</h2>
        <div id="statusBox" style="font-size: 0.8rem; color: var(--orange); background: #000; padding: 15px; border: 1px solid var(--border); min-height: 215px; white-space: pre-wrap;">
            Terminal verisi bekleniyor...
        </div>
        <button class="btn" style="margin-top: 10px;" onclick="getSystemInfo()">SİSTEMİ TARA</button>
    </div>
</div>

<script>
    const API_URL = 'https://api.mail.tm';
    let currentToken = "";
    let currentAddress = "";

    // --- MAIL.TM DOCS UYUMLU FONKSİYONLAR ---

    async function generateNewMail() {
        const addrDiv = document.getElementById('mailAddr');
        const inboxDiv = document.getElementById('mailInbox');
        addrDiv.innerText = "REQUESTING DOMAINS...";
        inboxDiv.innerHTML = '<div class="loading-spinner">Contacting Mail.tm nodes...</div>';

        try {
            // 1. Resmi dokümanlara göre aktif domainleri çek
            const domainRes = await fetch(`${API_URL}/domains`);
            const domainData = await domainRes.json();
            const domain = domainData['hydra:member'][0].domain;

            // 2. Rastgele abuk subuk kimlik oluştur
            const user = Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 5);
            const address = `${user}@${domain}`;
            const password = Math.random().toString(36).substring(2, 15);

            // 3. Hesap oluştur (/accounts endpoint)
            const accountRes = await fetch(`${API_URL}/accounts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/ld+json' },
                body: JSON.stringify({ address, password })
            });

            if (!accountRes.ok) throw new Error("Account creation failed");

            // 4. JWT Token al (/token endpoint)
            const tokenRes = await fetch(`${API_URL}/token`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/ld+json' },
                body: JSON.stringify({ address, password })
            });
            const tokenData = await tokenRes.json();
            
            currentToken = tokenData.token; // API anahtarımız artık bu
            currentAddress = address;

            addrDiv.innerText = currentAddress;
            inboxDiv.innerHTML = '<div style="text-align: center; color: var(--accent); padding: 20px;">[+] SESSION ESTABLISHED<br>Monitoring incoming traffic...</div>';
            
            console.log("Auth Success. Token saved.");
        } catch (err) {
            console.error(err);
            addrDiv.innerText = "PROTOCOL ERROR!";
            inboxDiv.innerHTML = '<div style="text-align: center; color: var(--red); padding: 20px;">Bağlantı Reddildi.<br>CORS veya Proxy kısıtlaması mevcut.</div>';
        }
    }

    async function refreshInbox() {
        if (!currentToken) return;
        const inbox = document.getElementById('mailInbox');
        inbox.innerHTML = '<div class="loading-spinner">Scanning API for new signals...</div>';

        try {
            // Dokümanlardaki /messages endpointi
            const res = await fetch(`${API_URL}/messages`, {
                headers: { 
                    'Authorization': `Bearer ${currentToken}`,
                    'Accept': 'application/ld+json'
                }
            });
            const data = await res.json();
            const messages = data['hydra:member'];

            if (messages.length === 0) {
                inbox.innerHTML = '<div style="text-align: center; color: #444; padding: 20px;">Gelen kutusu temiz.</div>';
            } else {
                inbox.innerHTML = "";
                messages.forEach(msg => {
                    const item = document.createElement('div');
                    item.className = 'mail-item';
                    item.innerHTML = `
                        <span class="mail-subject">${msg.subject || '(No Subject)'}</span>
                        <div class="mail-meta">Kimden: ${msg.from.address}</div>
                        <div class="mail-meta">Tarih: ${new Date(msg.createdAt).toLocaleString('tr-TR')}</div>
                    `;
                    item.onclick = () => viewMailContent(msg.id);
                    inbox.appendChild(item);
                });
            }
        } catch (e) {
            inbox.innerHTML = '<div style="text-align: center; color: var(--red); padding: 20px;">Veri çekme hatası.</div>';
        }
    }

    async function viewMailContent(id) {
        try {
            const res = await fetch(`${API_URL}/messages/${id}`, {
                headers: { 'Authorization': `Bearer ${currentToken}` }
            });
            const data = await res.json();
            // Basitlik için alert, profesyonel projede modal kullanılabilir
            alert("MAİL İÇERİĞİ:\n\n" + (data.text || "İçerik sadece HTML formatında veya boş."));
        } catch (e) {
            alert("Mesaj okunamadı.");
        }
    }

    function copyMail() {
        if(currentAddress) {
            navigator.clipboard.writeText(currentAddress);
            alert("Pano: Adres kopyalandı.");
        }
    }

    async function getSystemInfo() {
        const statusBox = document.getElementById('statusBox');
        statusBox.innerText = "Analiz yapılıyor...";
        try {
            const r = await fetch('https://api.ipify.org?format=json');
            const d = await r.json();
            statusBox.innerText = 
                `[+] NETWORK IP : ${d.ip}\n` +
                `[+] PLATFORM   : ${navigator.platform}\n` +
                `[+] PROTOCOL   : TLS v1.3 / HTTPS\n` +
                `[+] MAIL ENGINE: Mail.tm Official v3\n` +
                `[+] AUTH STATE : ${currentToken ? 'ACTIVE' : 'IDLE'}\n` +
                `[+] TIMESTAMP  : ${new Date().toLocaleTimeString()}\n` +
                `[!] STATUS     : SECURE`;
        } catch {
            statusBox.innerText = "Sistem verisi alınamadı.";
        }
    }

    window.onload = () => {
        getSystemInfo();
        generateNewMail();
    };
</script>
</body>
    </html>
