<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SADRAZAM OS - MAIL</title>
<style>
body{background:#030303;color:#e0e0e0;font-family:Consolas,monospace;display:flex;justify-content:center;align-items:center;height:100vh}
.card{width:420px;background:#0a0a0a;border:1px solid #1a1a1a;padding:20px}
.btn{width:100%;padding:12px;margin-top:10px;background:none;border:1px solid #00ffcc;color:#00ffcc;cursor:pointer}
.addr{margin:15px 0;padding:10px;border:1px dashed #00ffcc;text-align:center}
.inbox{height:200px;border:1px solid #1a1a1a;overflow:auto;padding:10px}
.mail{border-bottom:1px solid #222;padding:6px;cursor:pointer}
</style>
</head>
<body>

<div class="card">
  <h3>Temp Mail</h3>
  <div id="addr" class="addr">HAZIR</div>
  <button class="btn" onclick="createMail()">YENİ MAİL</button>
  <div id="inbox" class="inbox">Inbox boş</div>
  <button class="btn" onclick="loadInbox()">YENİLE</button>
</div>

<script>
let token = "";
let address = "";
let password = "";

async function callProxy(action, data={}, method="GET") {
  let url = `/api/proxy?action=${action}`;
  const opt = { method };

  if (method === "POST") {
    opt.headers = { "Content-Type": "application/json" };
    opt.body = JSON.stringify(data);
  } else {
    url += "&" + new URLSearchParams(data).toString();
  }

  const r = await fetch(url, opt);
  if (!r.ok) throw new Error("proxy error");
  return await r.json();
}

async function createMail() {
  document.getElementById("addr").innerText = "OLUŞTURULUYOR...";
  const d = await callProxy("domains");
  const domain = d["hydra:member"][0].domain;

  const user = Math.random().toString(36).slice(2,10);
  password = "pw123456";
  address = `${user}@${domain}`;

  await callProxy("create",{address,password},"POST");
  const t = await callProxy("token",{address,password},"POST");

  token = t.token;
  document.getElementById("addr").innerText = address;
}

async function loadInbox() {
  if (!token) return;
  const box = document.getElementById("inbox");
  box.innerHTML = "Yükleniyor...";
  const d = await callProxy("messages",{token});
  box.innerHTML = "";

  d["hydra:member"].forEach(m=>{
    const div=document.createElement("div");
    div.className="mail";
    div.innerText=m.subject||"(Konu yok)";
    div.onclick=async()=>{
      const c=await callProxy("message",{token,id:m.id});
      alert(c.text||"İçerik yok");
    };
    box.appendChild(div);
  });
}
</script>

</body>
</html>

